"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function _taggedTemplateLiteral(e,t){return t=t||e.slice(0),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return n}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function getPatternPart(e){return e instanceof RegExp?e.source:null==e?".*":e}function parse(r){for(var e=arguments.length,t=new Array(1<e?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return t.reduce(function(e,t,n){return e.concat("(".concat(getPatternPart(t),")"),r[n+1])},[r[0]]).join("")}var Router=function(){function n(e,t){_classCallCheck(this,n),this.routes=e||{},this.context=t||this,this.notFound=null,this.navigate=this.navigate.bind(this)}return _createClass(n,[{key:"start",value:function(e){var t=!(0<arguments.length&&void 0!==e)||e;window.addEventListener("hashchange",this.navigate),t&&this.navigate()}},{key:"stop",value:function(){window.removeEventListener("hashchange",this.navigate)}},{key:"navigate",value:function(){var e=this.constructor.normalize(window.location.hash);for(var t in this.routes){var n=e.match(new RegExp("^".concat(t,"$")));if(n)return this.routes[t].apply(this.context,n)}if("function"==typeof this.notFound)return this.notFound.call(this.context,e)}}],[{key:"normalize",value:function(e){return e.replace(/^#|\/*$/g,"")}}]),n}(),cssColors={black:"#000",darkGreyBlue:"#283038",darkGrey1:"#343434",darkGrey2:"#484848",darkGrey3:"#686868",grey1:"#888888",grey2:"#a8a8a8",lightGrey1:"#c8c8c8",lightGrey2:"#d8d8d8",lightGrey3:"#f0f0f0",lightGrey4:"#f8f8f8",lightBlue:"#1d91c0",white:"#fff"},config={debug:!1,defaultDataYear:"2021",dataUrls:{yearList:"data/years.json",yearsBase:"data/years",artistsByGenres:"data/artists-by-genres.json"},links:{lastfm:{url:"https://www.last.fm/user/markhovskiy/",text:"markhovskiy"},github:{url:"https://github.com/music-stats/timeline/",text:"music-stats/timeline"},twitter:{url:"https://twitter.com/oleksmarkh/",text:"@oleksmarkh"}},timeline:{zoomDeltaFactor:.01,minTimeRange:864e5,plot:{padding:12,backgroundColor:cssColors.darkGreyBlue},point:{size:3,maxMargin:1,selectedColor:cssColors.white,colorValueFactors:{other:{saturation:.5,lightness:.6},genre:{saturation:1.1,lightness:1},artistLabel:{saturation:1.4,lightness:1.6},artist:{saturation:1.4,lightness:1.8}}},labels:{areaPadding:4,margin:1,highlightedHeight:16,highlightedColor:cssColors.white},timeAxis:{width:2,tickLabelCount:40,timeFullColor:cssColors.darkGrey2,timeRangeColor:cssColors.darkGrey3},legend:{height:150},unknownGenreColorRange:["#525252","#bdbdbd"]},genreGroups:{Classical:{colorRange:["#bdbdbd","#f0f0f0"],genres:["Classical","Tango"]},"Electronic, Pop":{colorRange:["#cc4c02","#fec44f"],genres:["Ambient","Art Pop","Darkwave","Dream Pop","Electronic","Indie Pop","Industrial","Pop","Singer-songwriter","Trip Hop"]},Jazzy:{colorRange:["#fec44f","#fff7bc"],genres:["Blues","Funk","Hip-hop","Jazz","Rock And Roll","Rockabilly","Soul"]},Folk:{colorRange:["#238b45","#a1d99b"],genres:["Acoustic","Bluegrass","Dark Country","Dark Folk","Folk Metal","Folk Rock","Folk","Freak Folk"]},Rock:{colorRange:["#2171b5","#9ecae1"],genres:["Alternative Rock","Classic Rock","Gothic Rock","Indie Rock","Industrial Rock","Instrumental Rock","Pop Rock","Post-rock","Progressive Rock","Stoner Rock"]},Metal:{colorRange:["#88419d","#9ebcda"],genres:["Black Metal","Death Metal","Deathcore","Doom Metal","Gothic Metal","Groove Metal","Heavy Metal","Industrial Metal","Melodic Black Metal","Melodic Death Metal","Metalcore","Nu Metal","Post-black","Power Metal","Progressive Death Metal","Progressive Metal","Sludge Metal","Speed Metal","Symphonic Metal","Thrash Metal"]},Punk:{colorRange:["#ce1256","#c994c7"],genres:["Grunge","Hardcore","Post-punk","Punk Rock","Screamo","Ska Punk","Ska"]}}};function getSummary(e){var s={};e.forEach(function(e){var t=e.artist,n=e.album,r=e.track;s[t.name]||(s[t.name]={albums:{},tracks:{}}),s[t.name].playcount=t.playcount,n.name&&(s[t.name].albums[n.name]=n.playcount),s[t.name].tracks[r.name]=r.playcount});var t=Object.keys(s).length,n=0,r=0,i=0,a=0;for(var o in s){var l=s[o],u=l.playcount,c=l.albums,f=l.tracks;for(var h in n+=Object.keys(c).length,r+=Object.keys(f).length,i<u&&(i=u),c){var m=c[h];a<m&&(a=m)}}var d=e.length,g=Math.ceil((e[e.length-1].timestamp-e[0].timestamp)/864e5);return{artistCount:t,albumCount:n,trackCount:r,maxArtistPlaycount:i,maxAlbumPlaycount:a,scrobbleCount:d,scrobblePerDayCount:Math.round(10*d/g)/10,getScrobbleTotals:function(e){var t=e.artist,n=e.album,r=e.track,i=s[t.name],a=i.playcount,o=i.albums,l=i.tracks;return{artist:a,album:o[n.name],track:l[r.name]}}}}function define(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function extend(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Color(){}var _darker=.7,_brighter=1/_darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function color_formatHex(){return this.rgb().formatHex()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=reHex.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?rgbn(t):3===n?new Rgb(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?rgba(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?rgba(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=reRgbInteger.exec(e))?new Rgb(t[1],t[2],t[3],1):(t=reRgbPercent.exec(e))?new Rgb(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=reRgbaInteger.exec(e))?rgba(t[1],t[2],t[3],t[4]):(t=reRgbaPercent.exec(e))?rgba(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=reHslPercent.exec(e))?hsla(t[1],t[2]/100,t[3]/100,1):(t=reHslaPercent.exec(e))?hsla(t[1],t[2]/100,t[3]/100,t[4]):named.hasOwnProperty(e)?rgbn(named[e]):"transparent"===e?new Rgb(NaN,NaN,NaN,0):null}function rgbn(e){return new Rgb(e>>16&255,e>>8&255,255&e,1)}function rgba(e,t,n,r){return r<=0&&(e=t=n=NaN),new Rgb(e,t,n,r)}function rgbConvert(e){return e instanceof Color||(e=color(e)),e?new Rgb((e=e.rgb()).r,e.g,e.b,e.opacity):new Rgb}function rgb(e,t,n,r){return 1===arguments.length?rgbConvert(e):new Rgb(e,t,n,null==r?1:r)}function Rgb(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function rgb_formatHex(){return"#"+hex(this.r)+hex(this.g)+hex(this.b)}function rgb_formatRgb(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function hex(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function hsla(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||1<=n?e=t=NaN:t<=0&&(e=NaN),new Hsl(e,t,n,r)}function hslConvert(e){if(e instanceof Hsl)return new Hsl(e.h,e.s,e.l,e.opacity);if(e instanceof Color||(e=color(e)),!e)return new Hsl;if(e instanceof Hsl)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,l=a-i,s=(a+i)/2;return l?(o=t===a?(n-r)/l+6*(n<r):n===a?(r-t)/l+2:(t-n)/l+4,l/=s<.5?a+i:2-a-i,o*=60):l=0<s&&s<1?0:o,new Hsl(o,l,s,e.opacity)}function hsl(e,t,n,r){return 1===arguments.length?hslConvert(e):new Hsl(e,t,n,null==r?1:r)}function Hsl(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function hsl2rgb(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function insertGenres(e,n){function t(t){r[t].genres.forEach(function(e){return i[e]=t})}var r=config.genreGroups,i={},a={};for(var o in r)t(o);function l(t){n[t].forEach(function(e){return a[e]=t})}for(var s in n)l(s);return e.map(function(e){var t=a[e.artist.name],n=i[t];return _objectSpread2(_objectSpread2({},e),t&&{artist:_objectSpread2(_objectSpread2({},e.artist),{},{genreGroup:n,genre:t})})})}function getGenreSortedList(e){var t=config.timeline.point.colorValueFactors,n=config.genreGroups,l={},r=[],s={};for(var i in e.forEach(function(e){var t=e.artist,n=t.name,r=t.playcount,i=t.genreGroup,a=t.genre;if(a){var o=l[a];o||(o={genreGroup:i,artistCount:0,playcount:0},l[a]=o),s[n]?o.playcount=o.playcount-s[n]+r:(o.artistCount+=1,o.playcount+=r),s[n]=r}}),l){var a=l[i],o=a.artistCount,u=a.playcount,c=a.genreGroup,f=n[c];if(f){var h=_slicedToArray(f.colorRange,1)[0],m=hsl(h),d=hsl(h);m.s*=t.other.saturation,m.l*=t.other.lightness,d.s*=t.genre.saturation,d.l*=t.genre.lightness,[m,d].forEach(function(e){1<e.s&&(e.s=1),1<e.l&&(e.l=1)}),r.push({name:i,group:c,artistCount:o,playcount:u,color:m,highlightedColor:d})}else console.warn("genre not found in the config: ".concat(i))}return r.sort(function(e,t){return t.playcount-e.playcount})}function ascending(e,t){return e<t?-1:t<e?1:t<=e?0:NaN}function bisector(n){var a=n,o=n;function l(e,t,n,r){for(null==n&&(n=0),null==r&&(r=e.length);n<r;){var i=n+r>>>1;o(e[i],t)<0?n=1+i:r=i}return n}return 1===n.length&&(a=function(e,t){return n(e)-t},o=ascendingComparator(n)),{left:l,center:function(e,t,n,r){null==n&&(n=0),null==r&&(r=e.length);var i=l(e,t,n,r-1);return n<i&&a(e[i-1],t)>-a(e[i],t)?i-1:i},right:function(e,t,n,r){for(null==n&&(n=0),null==r&&(r=e.length);n<r;){var i=n+r>>>1;0<o(e[i],t)?r=i:n=1+i}return n}}}function ascendingComparator(n){return function(e,t){return ascending(n(e),t)}}function number(e){return null===e?NaN:+e}define(Color,color,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb}),define(Rgb,rgb,extend(Color,{brighter:function(e){return e=null==e?_brighter:Math.pow(_brighter,e),new Rgb(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?_darker:Math.pow(_darker,e),new Rgb(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatRgb:rgb_formatRgb,toString:rgb_formatRgb})),define(Hsl,hsl,extend(Color,{brighter:function(e){return e=null==e?_brighter:Math.pow(_brighter,e),new Hsl(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?_darker:Math.pow(_darker,e),new Hsl(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Rgb(hsl2rgb(240<=e?e-240:120+e,i,r),hsl2rgb(e,i,r),hsl2rgb(e<120?240+e:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,bisectCenter=bisector(number).center,e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(e,t,n){var r,i,a,o,l=-1;if(n=+n,(e=+e)===(t=+t)&&0<n)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=tickIncrement(e,t,n))||!isFinite(o))return[];if(0<o)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++l<i;)a[l]=(e+l)*o;else for(o=-o,e=Math.ceil(e*o),t=Math.floor(t*o),a=new Array(i=Math.ceil(t-e+1));++l<i;)a[l]=(e+l)/o;return r&&a.reverse(),a}function tickIncrement(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return 0<=i?(e10<=a?10:e5<=a?5:e2<=a?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(e10<=a?10:e5<=a?5:e2<=a?2:1)}function tickStep(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return e10<=a?i*=10:e5<=a?i*=5:e2<=a&&(i*=2),t<e?-i:i}function initRange(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function initInterpolator(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}var constant=function(e){return function(){return e}};function linear(t,n){return function(e){return t+e*n}}function exponential(t,n,r){return t=Math.pow(t,r),n=Math.pow(n,r)-t,r=1/r,function(e){return Math.pow(t+e*n,r)}}function gamma(n){return 1==(n=+n)?nogamma:function(e,t){return t-e?exponential(e,t,n):constant(isNaN(e)?t:e)}}function nogamma(e,t){var n=t-e;return n?linear(e,n):constant(isNaN(e)?t:e)}var rgb$1=function e(t){var o=gamma(t);function n(t,e){var n=o((t=rgb(t)).r,(e=rgb(e)).r),r=o(t.g,e.g),i=o(t.b,e.b),a=nogamma(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=i(e),t.opacity=a(e),t+""}}return n.gamma=e,n}(1);function numberArray(t,n){n=n||[];var r,i=t?Math.min(n.length,t.length):0,a=n.slice();return function(e){for(r=0;r<i;++r)a[r]=t[r]*(1-e)+n[r]*e;return a}}function isNumberArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function genericArray(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=interpolate(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function date(t,n){var r=new Date;return t=+t,n=+n,function(e){return r.setTime(t*(1-e)+n*e),r}}function interpolateNumber(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}function object(e,t){var n,r={},i={};for(n in null!==e&&"object"===_typeof(e)||(e={}),null!==t&&"object"===_typeof(t)||(t={}),t)n in e?r[n]=interpolate(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(e){return function(){return e}}function one(t){return function(e){return t(e)+""}}function string(e,r){var t,n,i,a=reA.lastIndex=reB.lastIndex=0,o=-1,l=[],s=[];for(e+="",r+="";(t=reA.exec(e))&&(n=reB.exec(r));)(i=n.index)>a&&(i=r.slice(a,i),l[o]?l[o]+=i:l[++o]=i),(t=t[0])===(n=n[0])?l[o]?l[o]+=n:l[++o]=n:(l[++o]=null,s.push({i:o,x:interpolateNumber(t,n)})),a=reB.lastIndex;return a<r.length&&(i=r.slice(a),l[o]?l[o]+=i:l[++o]=i),l.length<2?s[0]?one(s[0].x):zero(r):(r=s.length,function(e){for(var t,n=0;n<r;++n)l[(t=s[n]).i]=t.x(e);return l.join("")})}function interpolate(e,t){var n,r=_typeof(t);return null==t||"boolean"===r?constant(t):("number"===r?interpolateNumber:"string"===r?(n=color(t))?(t=n,rgb$1):string:t instanceof color?rgb$1:t instanceof Date?date:isNumberArray(t)?numberArray:Array.isArray(t)?genericArray:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?object:interpolateNumber)(e,t)}function interpolateRound(t,n){return t=+t,n=+n,function(e){return Math.round(t*(1-e)+n*e)}}function constants(e){return function(){return e}}function number$1(e){return+e}var unit=[0,1];function identity(e){return e}function normalize(t,n){return(n-=t=+t)?function(e){return(e-t)/n}:constants(isNaN(n)?NaN:.5)}function clamper(t,n){var e;return n<t&&(e=t,t=n,n=e),function(e){return Math.max(t,Math.min(n,e))}}function bimap(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return a=i<r?(r=normalize(i,r),n(o,a)):(r=normalize(r,i),n(a,o)),function(e){return a(r(e))}}function polymap(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=normalize(n[o],n[o+1]),a[o]=t(e[o],e[o+1]);return function(e){var t=bisectRight(n,e,1,r)-1;return a[t](i[t](e))}}function copy(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function transformer(){var n,r,t,i,a,o,l=unit,s=unit,u=interpolate,c=identity;function f(){var e=Math.min(l.length,s.length);return c!==identity&&(c=clamper(l[0],l[e-1])),i=2<e?polymap:bimap,a=o=null,h}function h(e){return isNaN(e=+e)?t:(a=a||i(l.map(n),s,u))(n(c(e)))}return h.invert=function(e){return c(r((o=o||i(s,l.map(n),interpolateNumber))(e)))},h.domain=function(e){return arguments.length?(l=Array.from(e,number$1),f()):l.slice()},h.range=function(e){return arguments.length?(s=Array.from(e),f()):s.slice()},h.rangeRound=function(e){return s=Array.from(e),u=interpolateRound,f()},h.clamp=function(e){return arguments.length?(c=!!e||identity,f()):c!==identity},h.interpolate=function(e){return arguments.length?(u=e,f()):u},h.unknown=function(e){return arguments.length?(t=e,h):t},function(e,t){return n=e,r=t,f()}}function continuous(){return transformer()(identity,identity)}function formatDecimal(e){return 1e21<=Math.abs(e=Math.round(e))?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function formatDecimalParts(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[1<r.length?r[0]+r.slice(2):r,+e.slice(n+1)]}function exponent(e){return(e=formatDecimalParts(Math.abs(e)))?e[1]:NaN}function formatGroup(l,s){return function(e,t){for(var n=e.length,r=[],i=0,a=l[0],o=0;0<n&&0<a&&(t<o+a+1&&(a=Math.max(1,t-o)),r.push(e.substring(n-=a,n+a)),!((o+=a+1)>t));)a=l[i=(i+1)%l.length];return r.reverse().join(s)}}function formatNumerals(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}var prefixExponent,re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(e){if(!(t=re.exec(e)))throw new Error("invalid format: "+e);var t;return new FormatSpecifier({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function FormatSpecifier(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function formatTrim(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;0<i&&(i=0)}return 0<i?e.slice(0,i)+e.slice(t+1):e}function formatPrefixAuto(e,t){var n=formatDecimalParts(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:o<a?r+new Array(a-o+1).join("0"):0<a?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+formatDecimalParts(e,Math.max(0,t+a-1))[0]}function formatRounded(e,t){var n=formatDecimalParts(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}formatSpecifier.prototype=FormatSpecifier.prototype,FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var formatTypes={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:formatDecimal,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return formatRounded(100*e,t)},r:formatRounded,s:formatPrefixAuto,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function identity$1(e){return e}var locale,format,formatPrefix,map=Array.prototype.map,prefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(e){var w=void 0===e.grouping||void 0===e.thousands?identity$1:formatGroup(map.call(e.grouping,Number),e.thousands+""),r=void 0===e.currency?"":e.currency[0]+"",i=void 0===e.currency?"":e.currency[1]+"",x=void 0===e.decimal?".":e.decimal+"",C=void 0===e.numerals?identity$1:formatNumerals(map.call(e.numerals,String)),a=void 0===e.percent?"%":e.percent+"",T=void 0===e.minus?"−":e.minus+"",_=void 0===e.nan?"NaN":e.nan+"";function o(e){var u=(e=formatSpecifier(e)).fill,c=e.align,f=e.sign,t=e.symbol,h=e.zero,m=e.width,d=e.comma,g=e.precision,p=e.trim,b=e.type;"n"===b?(d=!0,b="g"):formatTypes[b]||(void 0===g&&(g=12),p=!0,b="g"),(h||"0"===u&&"="===c)&&(h=!0,u="0",c="=");var y="$"===t?r:"#"===t&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",v="$"===t?i:/[%p]/.test(b)?a:"",k=formatTypes[b],M=/[defgprs%]/.test(b);function n(e){var t,n,r,i=y,a=v;if("c"===b)a=k(e)+a,e="";else{var o=(e=+e)<0||1/e<0;if(e=isNaN(e)?_:k(Math.abs(e),g),p&&(e=formatTrim(e)),o&&0==+e&&"+"!==f&&(o=!1),i=(o?"("===f?f:T:"-"===f||"("===f?"":f)+i,a=("s"===b?prefixes[8+prefixExponent/3]:"")+a+(o&&"("===f?")":""),M)for(t=-1,n=e.length;++t<n;)if((r=e.charCodeAt(t))<48||57<r){a=(46===r?x+e.slice(t+1):e.slice(t))+a,e=e.slice(0,t);break}}d&&!h&&(e=w(e,1/0));var l=i.length+e.length+a.length,s=l<m?new Array(m-l+1).join(u):"";switch(d&&h&&(e=w(s+e,s.length?m-a.length:1/0),s=""),c){case"<":e=i+e+a+s;break;case"=":e=i+s+e+a;break;case"^":e=s.slice(0,l=s.length>>1)+i+e+a+s.slice(l);break;default:e=s+i+e+a}return C(e)}return g=void 0===g?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),n.toString=function(){return e+""},n}return{format:o,formatPrefix:function(e,t){var n=o(((e=formatSpecifier(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(exponent(t)/3))),i=Math.pow(10,-r),a=prefixes[8+r/3];return function(e){return n(i*e)+a}}}}function defaultLocale(e){return locale=formatLocale(e),format=locale.format,formatPrefix=locale.formatPrefix,locale}function precisionFixed(e){return Math.max(0,-exponent(Math.abs(e)))}function precisionPrefix(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(t)/3)))-exponent(Math.abs(e)))}function precisionRound(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,exponent(t)-exponent(e))+1}function tickFormat(e,t,n,r){var i,a=tickStep(e,t,n);switch((r=formatSpecifier(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=precisionPrefix(a,o))||(r.precision=i),formatPrefix(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=precisionRound(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=precisionFixed(a))||(r.precision=i-2*("%"===r.type))}return format(r)}function linearish(u){var c=u.domain;return u.ticks=function(e){var t=c();return ticks(t[0],t[t.length-1],null==e?10:e)},u.tickFormat=function(e,t){var n=c();return tickFormat(n[0],n[n.length-1],null==e?10:e,t)},u.nice=function(e){null==e&&(e=10);var t,n,r=c(),i=0,a=r.length-1,o=r[i],l=r[a],s=10;for(l<o&&(n=o,o=l,l=n,n=i,i=a,a=n);0<s--;){if((n=tickIncrement(o,l,e))===t)return r[i]=o,r[a]=l,c(r);if(0<n)o=Math.floor(o/n)*n,l=Math.ceil(l/n)*n;else{if(!(n<0))break;o=Math.ceil(o*n)/n,l=Math.floor(l*n)/n}t=n}return u},u}function linear$1(){var e=continuous();return e.copy=function(){return copy(e,linear$1())},initRange.apply(e,arguments),linearish(e)}function nice(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}defaultLocale({thousands:",",grouping:[3],currency:["$",""]});var t0=new Date,t1=new Date;function newInterval(a,o,n,r){function l(e){return a(e=0===arguments.length?new Date:new Date(+e)),e}return l.floor=function(e){return a(e=new Date(+e)),e},l.ceil=function(e){return a(e=new Date(e-1)),o(e,1),a(e),e},l.round=function(e){var t=l(e),n=l.ceil(e);return e-t<n-e?t:n},l.offset=function(e,t){return o(e=new Date(+e),null==t?1:Math.floor(t)),e},l.range=function(e,t,n){var r,i=[];if(e=l.ceil(e),n=null==n?1:Math.floor(n),!(e<t&&0<n))return i;for(;i.push(r=new Date(+e)),o(e,n),a(e),r<e&&e<t;);return i},l.filter=function(n){return newInterval(function(e){if(e<=e)for(;a(e),!n(e);)e.setTime(e-1)},function(e,t){if(e<=e)if(t<0)for(;++t<=0;)for(;o(e,-1),!n(e););else for(;0<=--t;)for(;o(e,1),!n(e););})},n&&(l.count=function(e,t){return t0.setTime(+e),t1.setTime(+t),a(t0),a(t1),Math.floor(n(t0,t1))},l.every=function(t){return t=Math.floor(t),isFinite(t)&&0<t?1<t?l.filter(r?function(e){return r(e)%t==0}:function(e){return l.count(0,e)%t==0}):l:null}),l}var millisecond=newInterval(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});millisecond.every=function(n){return n=Math.floor(n),isFinite(n)&&0<n?1<n?newInterval(function(e){e.setTime(Math.floor(e/n)*n)},function(e,t){e.setTime(+e+t*n)},function(e,t){return(t-e)/n}):millisecond:null};var durationSecond=1e3,durationMinute=6e4,durationHour=36e5,durationDay=864e5,durationWeek=6048e5,second=newInterval(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*durationSecond)},function(e,t){return(t-e)/durationSecond},function(e){return e.getUTCSeconds()}),minute=newInterval(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*durationSecond)},function(e,t){e.setTime(+e+t*durationMinute)},function(e,t){return(t-e)/durationMinute},function(e){return e.getMinutes()}),hour=newInterval(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*durationSecond-e.getMinutes()*durationMinute)},function(e,t){e.setTime(+e+t*durationHour)},function(e,t){return(t-e)/durationHour},function(e){return e.getHours()}),day=newInterval(function(e){return e.setHours(0,0,0,0)},function(e,t){return e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*durationMinute)/durationDay},function(e){return e.getDate()-1});function weekday(t){return newInterval(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*durationMinute)/durationWeek})}var sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),month=newInterval(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),year=newInterval(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});year.every=function(n){return isFinite(n=Math.floor(n))&&0<n?newInterval(function(e){e.setFullYear(Math.floor(e.getFullYear()/n)*n),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t*n)}):null};var utcDay=newInterval(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/durationDay},function(e){return e.getUTCDate()-1});function utcWeekday(t){return newInterval(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/durationWeek})}var utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcYear=newInterval(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});function localDate(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function utcDate(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function newDate(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function formatLocale$1(e){var r=e.dateTime,i=e.date,a=e.time,t=e.periods,n=e.days,o=e.shortDays,l=e.months,s=e.shortMonths,u=formatRe(t),c=formatLookup(t),f=formatRe(n),h=formatLookup(n),m=formatRe(o),d=formatLookup(o),g=formatRe(l),p=formatLookup(l),b=formatRe(s),y=formatLookup(s),v={a:function(e){return o[e.getDay()]},A:function(e){return n[e.getDay()]},b:function(e){return s[e.getMonth()]},B:function(e){return l[e.getMonth()]},c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,g:formatYearISO,G:formatFullYearISO,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:function(e){return t[+(12<=e.getHours())]},q:function(e){return 1+~~(e.getMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},k={a:function(e){return o[e.getUTCDay()]},A:function(e){return n[e.getUTCDay()]},b:function(e){return s[e.getUTCMonth()]},B:function(e){return l[e.getUTCMonth()]},c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,g:formatUTCYearISO,G:formatUTCFullYearISO,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:function(e){return t[+(12<=e.getUTCHours())]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},M={a:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=b.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=p.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,t,n){return C(e,r,t,n)},d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,g:parseYear,G:parseFullYear,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:function(e,t,n){return C(e,i,t,n)},X:function(e,t,n){return C(e,a,t,n)},y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};function w(s,u){return function(e){var t,n,r,i=[],a=-1,o=0,l=s.length;for(e instanceof Date||(e=new Date(+e));++a<l;)37===s.charCodeAt(a)&&(i.push(s.slice(o,a)),null!=(n=pads[t=s.charAt(++a)])?t=s.charAt(++a):n="e"===t?" ":"0",(r=u[t])&&(t=r(e,n)),i.push(t),o=a+1);return i.push(s.slice(o,a)),i.join("")}}function x(i,a){return function(e){var t,n,r=newDate(1900,void 0,1);if(C(r,i,e+="",0)!=e.length)return null;if("Q"in r)return new Date(r.Q);if("s"in r)return new Date(1e3*r.s+("L"in r?r.L:0));if(!a||"Z"in r||(r.Z=0),"p"in r&&(r.H=r.H%12+12*r.p),void 0===r.m&&(r.m="q"in r?r.q:0),"V"in r){if(r.V<1||53<r.V)return null;"w"in r||(r.w=1),"Z"in r?(t=4<(n=(t=utcDate(newDate(r.y,0,1))).getUTCDay())||0===n?utcMonday.ceil(t):utcMonday(t),t=utcDay.offset(t,7*(r.V-1)),r.y=t.getUTCFullYear(),r.m=t.getUTCMonth(),r.d=t.getUTCDate()+(r.w+6)%7):(t=4<(n=(t=localDate(newDate(r.y,0,1))).getDay())||0===n?monday.ceil(t):monday(t),t=day.offset(t,7*(r.V-1)),r.y=t.getFullYear(),r.m=t.getMonth(),r.d=t.getDate()+(r.w+6)%7)}else("W"in r||"U"in r)&&("w"in r||(r.w="u"in r?r.u%7:"W"in r?1:0),n="Z"in r?utcDate(newDate(r.y,0,1)).getUTCDay():localDate(newDate(r.y,0,1)).getDay(),r.m=0,r.d="W"in r?(r.w+6)%7+7*r.W-(n+5)%7:r.w+7*r.U-(n+6)%7);return"Z"in r?(r.H+=r.Z/100|0,r.M+=r.Z%100,utcDate(r)):localDate(r)}}function C(e,t,n,r){for(var i,a,o=0,l=t.length,s=n.length;o<l;){if(s<=r)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=M[i in pads?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return v.x=w(i,v),v.X=w(a,v),v.c=w(r,v),k.x=w(i,k),k.X=w(a,k),k.c=w(r,k),{format:function(e){var t=w(e+="",v);return t.toString=function(){return e},t},parse:function(e){var t=x(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=w(e+="",k);return t.toString=function(){return e},t},utcParse:function(e){var t=x(e+="",!0);return t.toString=function(){return e},t}}}utcYear.every=function(n){return isFinite(n=Math.floor(n))&&0<n?newInterval(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/n)*n),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t*n)}):null};var locale$1,timeFormat,timeParse,utcFormat,utcParse,pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function requote(e){return e.replace(requoteRe,"\\$&")}function formatRe(e){return new RegExp("^(?:"+e.map(requote).join("|")+")","i")}function formatLookup(e){return new Map(e.map(function(e,t){return[e.toLowerCase(),t]}))}function parseWeekdayNumberSunday(e,t,n){var r=numberRe.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function parseWeekdayNumberMonday(e,t,n){var r=numberRe.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function parseWeekNumberSunday(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function parseWeekNumberISO(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function parseWeekNumberMonday(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function parseFullYear(e,t,n){var r=numberRe.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function parseYear(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(68<+r[0]?1900:2e3),n+r[0].length):-1}function parseZone(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function parseQuarter(e,t,n){var r=numberRe.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function parseMonthNumber(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function parseDayOfMonth(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function parseDayOfYear(e,t,n){var r=numberRe.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function parseHour24(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function parseMinutes(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function parseSeconds(e,t,n){var r=numberRe.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function parseMilliseconds(e,t,n){var r=numberRe.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function parseMicroseconds(e,t,n){var r=numberRe.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function parseLiteralPercent(e,t,n){var r=percentRe.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function parseUnixTimestamp(e,t,n){var r=numberRe.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function parseUnixTimestampSeconds(e,t,n){var r=numberRe.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function formatDayOfMonth(e,t){return pad(e.getDate(),t,2)}function formatHour24(e,t){return pad(e.getHours(),t,2)}function formatHour12(e,t){return pad(e.getHours()%12||12,t,2)}function formatDayOfYear(e,t){return pad(1+day.count(year(e),e),t,3)}function formatMilliseconds(e,t){return pad(e.getMilliseconds(),t,3)}function formatMicroseconds(e,t){return formatMilliseconds(e,t)+"000"}function formatMonthNumber(e,t){return pad(e.getMonth()+1,t,2)}function formatMinutes(e,t){return pad(e.getMinutes(),t,2)}function formatSeconds(e,t){return pad(e.getSeconds(),t,2)}function formatWeekdayNumberMonday(e){var t=e.getDay();return 0===t?7:t}function formatWeekNumberSunday(e,t){return pad(sunday.count(year(e)-1,e),t,2)}function dISO(e){var t=e.getDay();return 4<=t||0===t?thursday(e):thursday.ceil(e)}function formatWeekNumberISO(e,t){return e=dISO(e),pad(thursday.count(year(e),e)+(4===year(e).getDay()),t,2)}function formatWeekdayNumberSunday(e){return e.getDay()}function formatWeekNumberMonday(e,t){return pad(monday.count(year(e)-1,e),t,2)}function formatYear(e,t){return pad(e.getFullYear()%100,t,2)}function formatYearISO(e,t){return pad((e=dISO(e)).getFullYear()%100,t,2)}function formatFullYear(e,t){return pad(e.getFullYear()%1e4,t,4)}function formatFullYearISO(e,t){var n=e.getDay();return pad((e=4<=n||0===n?thursday(e):thursday.ceil(e)).getFullYear()%1e4,t,4)}function formatZone(e){var t=e.getTimezoneOffset();return(0<t?"-":(t*=-1,"+"))+pad(t/60|0,"0",2)+pad(t%60,"0",2)}function formatUTCDayOfMonth(e,t){return pad(e.getUTCDate(),t,2)}function formatUTCHour24(e,t){return pad(e.getUTCHours(),t,2)}function formatUTCHour12(e,t){return pad(e.getUTCHours()%12||12,t,2)}function formatUTCDayOfYear(e,t){return pad(1+utcDay.count(utcYear(e),e),t,3)}function formatUTCMilliseconds(e,t){return pad(e.getUTCMilliseconds(),t,3)}function formatUTCMicroseconds(e,t){return formatUTCMilliseconds(e,t)+"000"}function formatUTCMonthNumber(e,t){return pad(e.getUTCMonth()+1,t,2)}function formatUTCMinutes(e,t){return pad(e.getUTCMinutes(),t,2)}function formatUTCSeconds(e,t){return pad(e.getUTCSeconds(),t,2)}function formatUTCWeekdayNumberMonday(e){var t=e.getUTCDay();return 0===t?7:t}function formatUTCWeekNumberSunday(e,t){return pad(utcSunday.count(utcYear(e)-1,e),t,2)}function UTCdISO(e){var t=e.getUTCDay();return 4<=t||0===t?utcThursday(e):utcThursday.ceil(e)}function formatUTCWeekNumberISO(e,t){return e=UTCdISO(e),pad(utcThursday.count(utcYear(e),e)+(4===utcYear(e).getUTCDay()),t,2)}function formatUTCWeekdayNumberSunday(e){return e.getUTCDay()}function formatUTCWeekNumberMonday(e,t){return pad(utcMonday.count(utcYear(e)-1,e),t,2)}function formatUTCYear(e,t){return pad(e.getUTCFullYear()%100,t,2)}function formatUTCYearISO(e,t){return pad((e=UTCdISO(e)).getUTCFullYear()%100,t,2)}function formatUTCFullYear(e,t){return pad(e.getUTCFullYear()%1e4,t,4)}function formatUTCFullYearISO(e,t){var n=e.getUTCDay();return pad((e=4<=n||0===n?utcThursday(e):utcThursday.ceil(e)).getUTCFullYear()%1e4,t,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(e){return+e}function formatUnixTimestampSeconds(e){return Math.floor(e/1e3)}function defaultLocale$1(e){return locale$1=formatLocale$1(e),timeFormat=locale$1.format,timeParse=locale$1.parse,utcFormat=locale$1.utcFormat,utcParse=locale$1.utcParse,locale$1}defaultLocale$1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var durationSecond$1=1e3,durationMinute$1=60*durationSecond$1,durationHour$1=60*durationMinute$1,durationDay$1=24*durationHour$1,durationWeek$1=7*durationDay$1,durationMonth=30*durationDay$1,durationYear=365*durationDay$1;function date$1(e){return new Date(e)}function number$2(e){return e instanceof Date?+e:+new Date(+e)}function calendar(o,t,n,r,i,a,l,s,u){var c=continuous(),f=c.invert,h=c.domain,m=u(".%L"),d=u(":%S"),g=u("%I:%M"),p=u("%I %p"),b=u("%a %d"),y=u("%b %d"),v=u("%B"),k=u("%Y"),M=[[l,1,durationSecond$1],[l,5,5*durationSecond$1],[l,15,15*durationSecond$1],[l,30,30*durationSecond$1],[a,1,durationMinute$1],[a,5,5*durationMinute$1],[a,15,15*durationMinute$1],[a,30,30*durationMinute$1],[i,1,durationHour$1],[i,3,3*durationHour$1],[i,6,6*durationHour$1],[i,12,12*durationHour$1],[r,1,durationDay$1],[r,2,2*durationDay$1],[n,1,durationWeek$1],[t,1,durationMonth],[t,3,3*durationMonth],[o,1,durationYear]];function w(e){return(l(e)<e?m:a(e)<e?d:i(e)<e?g:r(e)<e?p:t(e)<e?n(e)<e?b:y:o(e)<e?v:k)(e)}function x(e,t,n){if(null==e&&(e=10),"number"!=typeof e)return e;var r,i=Math.abs(n-t)/e,a=bisector(function(e){return e[2]}).right(M,i);return(e=a===M.length?(r=tickStep(t/durationYear,n/durationYear,e),o):a?(r=(a=M[i/M[a-1][2]<M[a][2]/i?a-1:a])[1],a[0]):(r=Math.max(tickStep(t,n,e),1),s)).every(r)}return c.invert=function(e){return new Date(f(e))},c.domain=function(e){return arguments.length?h(Array.from(e,number$2)):h().map(date$1)},c.ticks=function(e){var t,n=h(),r=n[0],i=n[n.length-1],a=i<r;return a&&(t=r,r=i,i=t),t=(t=x(e,r,i))?t.range(r,i+1):[],a?t.reverse():t},c.tickFormat=function(e,t){return null==t?w:u(t)},c.nice=function(e){var t=h();return(e=x(e,t[0],t[t.length-1]))?h(nice(t,e)):c},c.copy=function(){return copy(c,calendar(o,t,n,r,i,a,l,s,u))},c}function time(){return initRange.apply(calendar(year,month,sunday,day,hour,minute,second,millisecond,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function transformer$1(){var n,r,i,a,t,o=0,l=1,s=identity,u=!1;function c(e){return isNaN(e=+e)?t:s(0===i?.5:(e=(a(e)-n)*i,u?Math.max(0,Math.min(1,e)):e))}function e(i){return function(e){var t,n,r;return arguments.length?(n=(t=_slicedToArray(e,2))[0],r=t[1],s=i(n,r),c):[s(0),s(1)]}}return c.domain=function(e){var t;return arguments.length?(t=_slicedToArray(e,2),o=t[0],l=t[1],n=a(o=+o),r=a(l=+l),i=n===r?0:1/(r-n),c):[o,l]},c.clamp=function(e){return arguments.length?(u=!!e,c):u},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.range=e(interpolate),c.rangeRound=e(interpolateRound),c.unknown=function(e){return arguments.length?(t=e,c):t},function(e){return n=(a=e)(o),r=e(l),i=n===r?0:1/(r-n),c}}function copy$1(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function sequential(){var e=linearish(transformer$1()(identity));return e.copy=function(){return copy$1(e,sequential())},initInterpolator.apply(e,arguments)}function insertColors(e,t){function i(e){return sequential().domain([1,t]).range(e)}var n=config.timeline,s=n.point.colorValueFactors,r=n.unknownGenreColorRange,a=config.genreGroups,u=i(r),c={};return Object.entries(a).forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1].colorRange;return c[n]=i(r)}),e.map(function(e){var t=e.artist.genreGroup,n=e.album.playcount,r=(c[t]||u)(n),i=hsl(r);i.s*=s.other.saturation,i.l*=s.other.lightness;var a=hsl(r);a.s*=s.genre.saturation,a.l*=s.genre.lightness;var o=hsl(r);o.s*=s.artist.saturation,o.l*=s.artist.lightness;var l=hsl(r);return l.s*=s.artistLabel.saturation,l.l*=s.artistLabel.lightness,[i,a,o,l].forEach(function(e){1<e.s&&(e.s=1),1<e.l&&(e.l=1)}),_objectSpread2(_objectSpread2({},e),{},{color:i,highlightedGenreColor:a,highlightedArtistColor:o,artistLabelColor:l})})}function uncompress(e){var t=_slicedToArray(e,7);return{date:t[0],track:{name:t[1],playcount:t[2]},album:{name:t[3],playcount:t[4]},artist:{name:t[5],playcount:t[6]}}}var monthNameList=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function dateTimeStringToTimestamp(e){return Date.parse(e.replace(" ","T"))}function dateTimeStringToDateString(e){return e.slice(0,10)}function timestampToDateTimeString(e){var t=new Date(e),n=monthNameList[t.getMonth()],r=_slicedToArray([t.getDate(),t.getHours(),t.getMinutes()].map(function(e){return e.toString().padStart(2,"0")}),3),i=r[0],a=r[1],o=r[2];return"".concat(n," ").concat(i," ").concat(a,":").concat(o)}function url(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return fillTemplate.apply(void 0,[function(e){return e.replace(/\s/g,"+")},e].concat(n))}function fillTemplate(r,i){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return t.reduce(function(e,t,n){return e.concat(r?r(t):String(t),i[n+1])},[i[0]]).join("")}var n=function e(t,n,r,i){var a;n[0]=0;for(var o=1;o<n.length;o++){var l=n[o++],s=n[o]?(n[0]|=l?1:2,r[n[o++]]):n[++o];3===l?i[0]=s:4===l?i[1]=Object.assign(i[1]||{},s):5===l?(i[1]=i[1]||{})[n[++o]]=s:6===l?i[1][n[++o]]+=s+"":l?(a=t.apply(s,e(t,s,r,["",null])),i.push(a),s[0]?n[0]|=2:(n[o-2]=0,n[o]=a)):i.push(s)}return i},t=new Map;function htm(e){var r=t.get(this);return r||(r=new Map,t.set(this,r)),1<(r=n(this,r.get(e)||(r.set(e,r=function(e){for(var t,n,r=1,i="",a="",o=[0],l=function(e){1===r&&(e||(i=i.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?o.push(0,e,i):3===r&&(e||i)?(o.push(3,e,i),r=2):2===r&&"..."===i&&e?o.push(4,e,0):2===r&&i&&!e?o.push(5,0,!0,i):5<=r&&((i||!e&&5===r)&&(o.push(r,0,i,n),r=6),e&&(o.push(r,e,0,n),r=6)),i=""},s=0;s<e.length;s++){s&&(1===r&&l(),l(s));for(var u=0;u<e[s].length;u++)t=e[s][u],1===r?"<"===t?(l(),o=[o],r=3):i+=t:4===r?i="--"===i&&">"===t?(r=1,""):t+i[0]:a?t===a?a="":i+=t:'"'===t||"'"===t?a=t:">"===t?(l(),r=1):r&&("="===t?(r=5,n=i,i=""):"/"===t&&(r<5||">"===e[s][u+1])?(l(),3===r&&(o=o[0]),(o=(r=o)[0]).push(2,0,r),r=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(l(),r=2):i+=t),3===r&&"!--"===i&&(r=4,o=o[0])}return l(),o}(e)),r),arguments,[])).length?r:r[0]}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return commonjsRequire(e,null==t?n.path:t)}},n.exports),n.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var vhtml=createCommonjsModule(function(e,t){var s,u,n,c,f,h;e.exports=(s=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],u=function(e){return String(e).replace(/[&<>"']/g,function(e){return"&"+n[e]+";"})},n={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},c="dangerouslySetInnerHTML",f={className:"class",htmlFor:"for"},h={},function(e,t){var n=[],r="";t=t||{};for(var i=arguments.length;2<i--;)n.push(arguments[i]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(var a in t)!1!==t[a]&&null!=t[a]&&a!==c&&(r+=" "+(f[a]?f[a]:u(a))+'="'+u(t[a])+'"');r+=">"}if(-1===s.indexOf(e)){if(t[c])r+=t[c].__html;else for(;n.length;){var o=n.pop();if(o)if(o.pop)for(var l=o.length;l--;)n.push(o[l]);else r+=!0===h[o]?o:u(o)}r+=e?"</"+e+">":""}return h[r]=!0,r})}),html=htm.bind(vhtml),Collection=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,t),this.list=e,this.firstVisibleIndex=0,this.lastVisibleIndex=this.list.length-1}return _createClass(t,[{key:"reset",value:function(){this.list=[],this.firstVisibleIndex=0,this.lastVisibleIndex=0}},{key:"setVisibleIndexRange",value:function(e,t){this.firstVisibleIndex=e,this.lastVisibleIndex=t}},{key:"push",value:function(){var e;return(e=this.list).push.apply(e,arguments)}},{key:"getAll",value:function(){return this.list}},{key:"getFirst",value:function(){return this.list[0]}},{key:"getLast",value:function(){return this.list[this.list.length-1]}},{key:"getFirstVisible",value:function(){return this.list[this.firstVisibleIndex]}},{key:"getLastVisible",value:function(){return this.list[this.lastVisibleIndex]}},{key:"forEachVisible",value:function(e){for(var t=this.firstVisibleIndex;t<=this.lastVisibleIndex;t+=1)e(this.list[t])}},{key:"findFirst",value:function(e){return this.list.find(e)}},{key:"findLast",value:function(e){for(var t=this.list.length-1;0<=t;--t){var n=this.list[t];if(e(n))return n}}},{key:"getAdjacentVisible",value:function(e,t,n){for(var r=this,i=2<arguments.length&&void 0!==n?n:function(){return!0},a=0<t?function(){return e<r.lastVisibleIndex}:function(){return e>r.firstVisibleIndex};a();){e+=t;var o=this.list[e];if(o&&i(o))return o}}}]),t}(),PointBuffer=function(){function t(e){_classCallCheck(this,t),this.tolerance=e,this.buffer={}}return _createClass(t,[{key:"reset",value:function(){this.buffer={}}},{key:"forEachPoint",value:function(e){for(var t in this.buffer){var n=this.buffer[t];for(var r in n)e(r,t,n[r])}}},{key:"putPoint",value:function(e){var t=e.x,n=e.y,r=_objectWithoutProperties(e,["x","y"]);this.buffer[n]||(this.buffer[n]={}),this.buffer[n][t]=r}},{key:"getPoint",value:function(e,t){var n=this.buffer[t];return n?n[e]:void 0}},{key:"getPointWithTolerance",value:function(e,t){for(var n=e-this.tolerance,r=e+this.tolerance,i=t-this.tolerance,a=t+this.tolerance,o=i;o<=a;o+=1){var l=this.buffer[o];if(l)for(var s=n;s<=r;s+=1){var u=l[s];if(u)return u}}}}]),t}();function _templateObject(){var e=_taggedTemplateLiteral(['\n      <canvas\n        id="plot"\n        class="Plot"\n      />\n    ']);return _templateObject=function(){return e},e}var Plot=function(){function t(e){_classCallCheck(this,t),this.props=e,this.dimensions=null,this.element=null,this.ctx=null}return _createClass(t,[{key:"initializeElement",value:function(){this.element=document.getElementById("plot")}},{key:"getDimensions",value:function(){return this.dimensions}},{key:"scale",value:function(){var e=config.timeline,t=e.plot.padding,n=e.legend.height,r=window.devicePixelRatio,i=window.innerWidth,a=window.innerHeight-(n+t);this.dimensions=[i,a],Object.assign(this.element,{width:i*r,height:a*r}),Object.assign(this.element.style,{width:"".concat(i,"px"),height:"".concat(a,"px")}),this.ctx=this.element.getContext("2d",{alpha:!1}),this.ctx.scale(r,r)}},{key:"drawBackground",value:function(){var e=config.timeline.plot.backgroundColor,t=_slicedToArray(this.dimensions,2),n=t[0],r=t[1];this.ctx.fillStyle=e,this.ctx.fillRect(0,0,n,r)}},{key:"drawTimeAxis",value:function(e,t,n,r){var i=config.timeline,a=i.plot.padding,o=i.timeAxis,l=o.width,s=o.timeFullColor,u=o.timeRangeColor,c=this.dimensions[1]-a;this.ctx.lineWidth=l,this.ctx.strokeStyle=s,this.ctx.beginPath(),this.ctx.moveTo(e,c),this.ctx.lineTo(t,c),this.ctx.stroke(),this.ctx.strokeStyle=u,this.ctx.beginPath(),this.ctx.moveTo(n,c),this.ctx.lineTo(r,c),this.ctx.stroke()}},{key:"drawPoint",value:function(e,t,n){var r=config.timeline.point.size,i=this.props.pointHalfSize;this.ctx.fillStyle=n,this.ctx.fillRect(e-i,t-i,r,r)}},{key:"afterRender",value:function(){this.initializeElement()}},{key:"render",value:function(){return html(_templateObject())}}]),t}();function createProxyMethod(e,i){return function(r){return e[r]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i[r].apply(i,t)}}}var PlotInteractive=function(){function n(e,t){_classCallCheck(this,n),this.props=e,this.plot=t,["getDimensions","scale","drawBackground","drawTimeAxis","drawPoint","render"].forEach(createProxyMethod(this,this.plot))}return _createClass(n,[{key:"subscribe",value:function(){var e=this.props,t=e.onMouseDown,n=e.onMouseUp,r=e.onMouseOut,i=e.onMouseMove,a=e.onWheel,o=this.plot.element;o.addEventListener("mousedown",t),o.addEventListener("mouseup",n),o.addEventListener("mouseout",r),o.addEventListener("mousemove",i),o.addEventListener("wheel",a)}},{key:"unsubscribe",value:function(){var e=this.props,t=e.onMouseDown,n=e.onMouseUp,r=e.onMouseOut,i=e.onMouseMove,a=e.onWheel,o=this.plot.element;o.removeEventListener("mousedown",t),o.removeEventListener("mouseup",n),o.removeEventListener("mouseout",r),o.removeEventListener("mousemove",i),o.removeEventListener("wheel",a)}},{key:"afterRender",value:function(){this.plot.afterRender(),this.subscribe()}}]),n}();function _templateObject$1(){var e=_taggedTemplateLiteral(["\n      <aside\n        id=",'\n        class="TimeAxisLabel"\n      />\n    ']);return _templateObject$1=function(){return e},e}var TimeAxisLabel=function(){function t(e){_classCallCheck(this,t),this.props=e,this.element=null}return _createClass(t,[{key:"initializeElement",value:function(){var e=config.timeline,t=e.plot.padding,n=e.timeAxis.width,r=e.legend.height,i=this.props,a=i.id,o=i.isMostTop,l=t-n/2;this.element=document.getElementById(a),Object.assign(this.element.style,{top:"calc(100% - ".concat(l+r+t,"px)"),lineHeight:"".concat(l,"px")}),o&&this.element.classList.add("TimeAxisLabel--most-top")}},{key:"clear",value:function(){this.element.innerText=""}},{key:"renderText",value:function(e,t,n){var r=config.timeline.point.size;this.element.innerText=t;var i=Math.ceil(this.element.offsetWidth/2),a=_slicedToArray(e-i<r?["".concat(r,"px"),"auto"]:n-r<e+i?["auto","".concat(r,"px")]:["".concat(e-i,"px"),"auto"],2),o=a[0],l=a[1];Object.assign(this.element.style,{left:o,right:l})}},{key:"afterRender",value:function(){this.initializeElement()}},{key:"render",value:function(){var e=this.props.id;return html(_templateObject$1(),e)}}]),t}(),classnames=createCommonjsModule(function(e){function o(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var r=_typeof(n);if("string"===r||"number"===r)e.push(n);else if(Array.isArray(n)&&n.length){var i=o.apply(null,n);i&&e.push(i)}else if("object"===r)for(var a in n)l.call(n,a)&&n[a]&&e.push(a)}}return e.join(" ")}var l;l={}.hasOwnProperty,e.exports?(o.default=o,e.exports=o):window.classNames=o});function _templateObject2(){var e=_taggedTemplateLiteral(['\n      <nav\n        class="YearNavigation list-box list-box--with-bg"\n      >\n        ',"\n      </nav>\n    "]);return _templateObject2=function(){return e},e}function _templateObject$2(){var e=_taggedTemplateLiteral(["\n      <a\n        class=",'\n        href="#','"\n      >\n        ',"\n      </a>\n    "]);return _templateObject$2=function(){return e},e}var YearNavigation=function(){function t(e){_classCallCheck(this,t),this.props=e}return _createClass(t,[{key:"renderYearLink",value:function(e){var t=this.props.currentYear;return html(_templateObject$2(),classnames("YearNavigation__year-link",{"YearNavigation__year-link--current":t===e}),e,e)}},{key:"render",value:function(){var e=this.props.yearList;return html(_templateObject2(),e.map(this.renderYearLink,this))}}]),t}();function _templateObject11(){var e=_taggedTemplateLiteral(['\n      <aside\n        class="InfoBox list-box list-box--with-rows list-box--with-bg"\n      >\n        <p\n          class="InfoBox__field--intro-message list-box__field"\n        >\n          '," scrobbles (",' per day)\n        </p>\n\n        <p\n          class="InfoBox__field--intro-message list-box__field"\n        >\n          '," artists, "," albums, ",' tracks\n        </p>\n\n        <p\n          id="info-box-field-artist-name"\n          class="InfoBox__field--scrobble-info list-box__field"\n        />\n\n        <p\n          id="info-box-field-album-name"\n          class="InfoBox__field--scrobble-info list-box__field"\n        />\n\n        <p\n          id="info-box-field-track-name"\n          class="InfoBox__field--scrobble-info list-box__field"\n        />\n      </aside>\n    ']);return _templateObject11=function(){return e},e}function _templateObject10(){var e=_taggedTemplateLiteral(["\n      <span>\n        <a href=",">","</a> <small>(","/",")</small>\n      </span>\n    "]);return _templateObject10=function(){return e},e}function _templateObject9(){var e=_taggedTemplateLiteral(["\n        <span>\n          <a href=",">","</a> <small>(","/",")</small>\n        </span>\n      "]);return _templateObject9=function(){return e},e}function _templateObject8(){var e=_taggedTemplateLiteral(["\n      <span>\n        <a href=",">","</a> <small>(","/",")</small>\n      </span>\n    "]);return _templateObject8=function(){return e},e}function _templateObject7(){var e=_taggedTemplateLiteral(["https://www.last.fm/music/","/_/",""]);return _templateObject7=function(){return e},e}function _templateObject6(){var e=_taggedTemplateLiteral(["https://www.last.fm/music/","/",""]);return _templateObject6=function(){return e},e}function _templateObject5(){var e=_taggedTemplateLiteral(["https://www.last.fm/music/",""]);return _templateObject5=function(){return e},e}function _templateObject4(){var e=_taggedTemplateLiteral(['\n        <a href="',"/tracks?",'">',"</a>\n      "]);return _templateObject4=function(){return e},e}function _templateObject3(){var e=_taggedTemplateLiteral(['\n        <a href="',"/albums?",'">',"</a>\n      "]);return _templateObject3=function(){return e},e}function _templateObject2$1(){var e=_taggedTemplateLiteral(['\n        <a href="',"/artists?",'">',"</a>\n      "]);return _templateObject2$1=function(){return e},e}function _templateObject$3(){var e=_taggedTemplateLiteral(['\n        <a href="',"?",'">',"</a>\n      "]);return _templateObject$3=function(){return e},e}var InfoBox=function(){function t(e){_classCallCheck(this,t),this.props=e,this.introMessageElementList=null,this.scrobbleInfoElementList=null,this.artistNameElement=null,this.albumNameElement=null,this.trackNameElement=null}return _createClass(t,[{key:"initializeElements",value:function(){this.introMessageElementList=document.querySelectorAll(".InfoBox__field--intro-message"),this.scrobbleInfoElementList=document.querySelectorAll(".InfoBox__field--scrobble-info"),this.artistNameElement=document.getElementById("info-box-field-artist-name"),this.albumNameElement=document.getElementById("info-box-field-album-name"),this.trackNameElement=document.getElementById("info-box-field-track-name")}},{key:"showIntroMessage",value:function(){this.introMessageElementList.forEach(function(e){return e.style.display="block"}),this.scrobbleInfoElementList.forEach(function(e){return e.style.display="none"})}},{key:"hideIntroMessage",value:function(){this.introMessageElementList.forEach(function(e){return e.style.display="none"})}},{key:"getLastfmLinks",value:function(){var e=config.links,t=this.props,n=t.dates,r=t.summary,i="".concat(e.lastfm.url,"library"),a=dateTimeStringToDateString(n.firstScrobbleDate),o=dateTimeStringToDateString(n.lastScrobbleDate),l="from=".concat(a,"&to=").concat(o);return{scrobbleListLink:html(_templateObject$3(),i,l,r.scrobbleCount),artistListLink:html(_templateObject2$1(),i,l,r.artistCount),albumListLink:html(_templateObject3(),i,l,r.albumCount),trackListLink:html(_templateObject4(),i,l,r.trackCount)}}},{key:"renderScrobbleInfo",value:function(e,t){var n=e.artist,r=e.album,i=e.track,a=url(_templateObject5(),n.name),o=url(_templateObject6(),n.name,r.name),l=url(_templateObject7(),n.name,i.name);this.artistNameElement.style.display="block",this.artistNameElement.innerHTML=html(_templateObject8(),a,n.name,n.playcount,t.artist),this.albumNameElement.style.display=r.name?"block":"none",this.albumNameElement.innerHTML=r.name?html(_templateObject9(),o,r.name,r.playcount,t.album):"",this.trackNameElement.style.display="block",this.trackNameElement.innerHTML=html(_templateObject10(),l,i.name,i.playcount,t.track)}},{key:"afterRender",value:function(){this.initializeElements()}},{key:"render",value:function(){var e=this.props.summary,t=this.getLastfmLinks(),n=t.scrobbleListLink,r=t.artistListLink,i=t.albumListLink,a=t.trackListLink;return html(_templateObject11(),n,e.scrobblePerDayCount,r,i,a)}}]),t}();function _templateObject$4(){var e=_taggedTemplateLiteral(['\n      <aside\n        class="ExternalLinks list-box list-box--with-rows"\n      >\n        <p\n          class="ExternalLinks__field list-box__field"\n        >\n          <a\n            class="ExternalLinks__link"\n            href=',"\n          >\n            ",'\n          </a>\n        </p>\n\n        <p\n          class="ExternalLinks__field list-box__field"\n        >\n          <a\n            class="ExternalLinks__link"\n            href=',"\n          >\n            ","\n          </a>\n        </p>\n      </aside>\n    "]);return _templateObject$4=function(){return e},e}var ExternalLinks=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"render",value:function(){var e=config.links,t=e.github,n=e.twitter;return html(_templateObject$4(),t.url,t.text,n.url,n.text)}}]),e}();function _templateObject2$2(){var e=_taggedTemplateLiteral(['\n      <nav\n        id="legend"\n        class="Legend"\n      >\n        ',"\n      </nav>\n    "]);return _templateObject2$2=function(){return e},e}function _templateObject$5(){var e=_taggedTemplateLiteral(['\n      <section\n        class="Legend__genre"\n        style="background-color: ','"\n        title=','\n      >\n        <span\n          class="Legend__genre-caption"\n        >\n          ',"\n        </span>\n      </section>\n    "]);return _templateObject$5=function(){return e},e}var Legend=function(){function t(e){_classCallCheck(this,t),this.props=e,this.element=null,this.genreElementCollection=[],this.genreList=getGenreSortedList(e.scrobbleList),this.heightScale=this.getHeightScale()}return _createClass(t,[{key:"initializeElements",value:function(){this.element=document.getElementById("legend"),this.genreElementCollection=this.element.getElementsByClassName("Legend__genre")}},{key:"getHeightScale",value:function(){var e=config.timeline.legend.height,t=Math.max.apply(Math,_toConsumableArray(this.genreList.map(function(e){return e.playcount})));return linear$1().domain([0,t]).range([0,e])}},{key:"afterRender",value:function(){this.initializeElements(),requestAnimationFrame(this.setGenreElementsHeight.bind(this))}},{key:"setGenreElementsHeight",value:function(){for(var e=0;e<this.genreElementCollection.length;e+=1){var t=this.genreElementCollection[e],n=this.genreList[e].playcount,r=Math.max(this.heightScale(n),1);t.style.height="".concat(r,"px")}}},{key:"renderGenre",value:function(e){var t=e.name,n=e.artistCount,r=e.playcount,i=e.color,a=this.props.scrobbleList,o=["".concat(n," artist").concat(1<n?"s":""),"".concat(r," scrobble").concat(1<r?"s":""," (").concat((100*r/a.length).toFixed(1),"%)")].join(", ");return html(_templateObject$5(),i,o,t)}},{key:"render",value:function(){return html(_templateObject2$2(),this.genreList.map(this.renderGenre,this))}}]),t}(),LegendInteractive=function(){function n(e,t){_classCallCheck(this,n),this.props=e,this.legend=t,this.highlightedGenreIndex=null,this.eventListeners={},createProxyMethod(this,this.legend)("render")}return _createClass(n,[{key:"subscribe",value:function(){for(var i=this,a=this.props.onGenreMouseEnter,e=this.legend,o=e.genreElementCollection,l=e.genreList,t=function(e){function t(){return a(r)}var n=o[e],r=l[e].name;i.eventListeners[r]=t,n.addEventListener("mouseenter",t)},n=0;n<o.length;n+=1)t(n)}},{key:"unsubscribe",value:function(){for(var e=this.legend,t=e.genreElementCollection,n=e.genreList,r=0;r<t.length;r+=1){var i=t[r],a=n[r].name;i.removeEventListener("mouseenter",this.eventListeners[a])}}},{key:"highlightGenre",value:function(t){var e=this.legend,n=e.genreElementCollection,r=e.genreList,i=r.findIndex(function(e){return e.name===t}),a=n[i],o=r[i].highlightedColor;a.classList.add("Legend__genre--highlighted"),a.style.backgroundColor=o,this.highlightedGenreIndex=i}},{key:"removeGenreHighlight",value:function(){if(null!==this.highlightedGenreIndex){var e=this.legend,t=e.genreElementCollection,n=e.genreList,r=t[this.highlightedGenreIndex],i=n[this.highlightedGenreIndex].color;r.classList.remove("Legend__genre--highlighted"),r.style.backgroundColor=i,this.highlightedGenreIndex=null}}},{key:"afterRender",value:function(){this.legend.afterRender(),this.subscribe()}}]),n}();function _templateObject$6(){var e=_taggedTemplateLiteral(['\n      <aside\n        id="artist-labels"\n        class="ArtistLabelCollection"\n        style="bottom: ','px"\n      />\n    ']);return _templateObject$6=function(){return e},e}var ArtistLabelCollection=function(){function e(){_classCallCheck(this,e),this.element=null,this.highlightedLabelElement=null,this.bboxList=[]}return _createClass(e,[{key:"initializeElements",value:function(){this.element=document.getElementById("artist-labels")}},{key:"removeAllLabels",value:function(){this.element.innerHTML="",this.highlightedLabelElement=null,this.bboxList=[]}},{key:"getLabelMinX",value:function(e,t,n){var r=config.timeline.labels.areaPadding,i=Math.ceil(t/2);return e-i<r?r:n-r<e+i?n-r-t:e-i}},{key:"getLabelMinY",value:function(t,n,e,r){var i,a=config.timeline,o=a.point.size,l=a.labels.margin,s=e-o,u=s-r,c=_createForOfIteratorHelper(this.bboxList.filter(function(e){return!(t>e.maxX+l||n<e.minX-l)}).sort(function(e,t){return t.minY-e.minY}));try{for(c.s();!(i=c.n()).done;){var f=i.value;s<f.minY-l||u>f.maxY+l||(u=(s=f.minY-l)-r)}}catch(e){c.e(e)}finally{c.f()}return u}},{key:"renderLabel",value:function(e,t,n){var r=e.x,i=e.y,a=e.text,o=e.scrobble.artistLabelColor,l=2<arguments.length&&void 0!==n&&n,s=config.timeline.labels.highlightedColor,u=document.createElement("span"),c=l?s:o;u.classList.add("ArtistLabelCollection__label"),u.innerText=a,l&&(this.highlightedLabelElement&&this.highlightedLabelElement.classList.remove("ArtistLabelCollection__label--highlighted"),u.classList.add("ArtistLabelCollection__label--highlighted"),this.highlightedLabelElement=u),this.element.appendChild(u);var f=u.offsetWidth,h=u.offsetHeight,m=this.getLabelMinX(r,f,t),d=m+f,g=this.getLabelMinY(m,d,i,h),p=g+h;this.bboxList.push({minX:m,minY:g,maxX:d,maxY:p}),Object.assign(u.style,{top:"".concat(g,"px"),left:"".concat(m,"px"),color:c})}},{key:"afterRender",value:function(){this.initializeElements()}},{key:"render",value:function(){var e=config.timeline,t=e.plot.padding,n=e.legend.height;return html(_templateObject$6(),n+t)}}]),e}();function _templateObject$7(){var e=_taggedTemplateLiteral(["\n      <main>\n        ","\n      </main>\n    "]);return _templateObject$7=function(){return e},e}var Timeline=function(){function r(e){_classCallCheck(this,r);var t=config.timeline.point.size,n=e.scrobbleList;this.props=e,this.children={},this.scrobbleHalfSize=Math.ceil(t/2),this.scrobbleCollection=new Collection(n),this.pointBuffer=new PointBuffer(this.scrobbleHalfSize),this.plotScales={}}return _createClass(r,[{key:"initializeChildrenComponents",value:function(){var e=config.timeline.timeAxis.tickLabelCount,t=this.props,n=t.summary,r=t.yearList,i=t.scrobbleList,a=t.onPlotMouseDown,o=t.onPlotMouseUp,l=t.onPlotMouseOut,s=t.onPlotMouseMove,u=t.onPlotWheel,c=t.onLegendGenreMouseEnter;this.children.plot=new PlotInteractive({onMouseDown:a,onMouseUp:o,onMouseOut:l,onMouseMove:s,onWheel:u},new Plot({pointHalfSize:this.scrobbleHalfSize})),this.children.yearNavigation=new YearNavigation({currentYear:document.location.hash.slice(1),yearList:r}),this.children.infoBox=new InfoBox({dates:{firstScrobbleDate:this.scrobbleCollection.getFirst().date,lastScrobbleDate:this.scrobbleCollection.getLast().date},summary:n}),this.children.externalLinks=new ExternalLinks,this.children.selectedScrobbleTimeLabel=new TimeAxisLabel({id:"selected-scrobble-time-label",isMostTop:!0});for(var f=0;f<e;f+=1)this.children["timeTickLabel".concat(f)]=new TimeAxisLabel({id:"time-tick-label--".concat(f)});this.children.legend=new LegendInteractive({onGenreMouseEnter:c},new Legend({scrobbleList:i})),this.children.artistLabelCollection=new ArtistLabelCollection}},{key:"getPlotScales",value:function(){for(var e=config.timeline,t=e.plot.padding,n=e.point,r=n.size,i=n.maxMargin,a=e.timeAxis.width,o=e.labels,l=o.areaPadding,s=o.highlightedHeight,u=this.props.summary,c=_slicedToArray(this.children.plot.getDimensions(),2),f=c[0],h=c[1]-t-a/2-r,m=h-l-s-r,d=i,g=m;0<=d;){var p=(u.maxArtistPlaycount-1)*(r+d);if(!(m<p)){g=p;break}--d}var b=h-g,y=t,v=f-t;return{timeAxis:time().domain([this.scrobbleCollection.getFirst().timestamp,this.scrobbleCollection.getLast().timestamp]).rangeRound([y,v]),x:time().domain([this.scrobbleCollection.getFirstVisible().timestamp,this.scrobbleCollection.getLastVisible().timestamp]).rangeRound([y,v]),y:linear$1().domain([1,u.maxArtistPlaycount]).rangeRound([h,b])}}},{key:"createScrobblePoint",value:function(e){var t=e.timestamp,n=e.artist;return{x:this.plotScales.x(t),y:this.plotScales.y(n.playcount),scrobble:e}}},{key:"draw",value:function(){var n=this,e=config.timeline.timeAxis.tickLabelCount,r=this.props.onScrobblePointCreate,t=this.plotScales,i=t.timeAxis,a=t.x,o=this.children.plot,l=o.getDimensions()[0],s=_slicedToArray(a.domain(),2),u=s[0],c=s[1],f=_slicedToArray(a.range(),2),h=f[0],m=f[1],d=i(u),g=i(c),p=a.ticks(600<l?12:4),b=a.tickFormat();o.drawBackground(),this.scrobbleCollection.forEachVisible(function(e){var t=n.createScrobblePoint(e);n.pointBuffer.putPoint(t),r(t)}),this.pointBuffer.forEachPoint(function(e,t,n){var r=n.scrobble.color;return o.drawPoint(e,t,r)}),o.drawTimeAxis(h,m,d,g),p.forEach(function(e,t){n.children["timeTickLabel".concat(t)].renderText(a(e),b(e),l)});for(var y=p.length;y<e;y+=1)this.children["timeTickLabel".concat(y)].clear()}},{key:"beforeRender",value:function(){this.initializeChildrenComponents()}},{key:"afterRender",value:function(){var e=this.children.plot;Object.values(this.children).forEach(function(e){"function"==typeof e.afterRender&&e.afterRender()}),e.scale(),this.plotScales=this.getPlotScales()}},{key:"render",value:function(){return html(_templateObject$7(),Object.values(this.children).map(function(e){return e.render()}))}}]),r}();function clamp(e,t,n){return Math.min(Math.max(e,t),n)}var Registry=function(){function t(e){_classCallCheck(this,t),this.getKey=e,this.registry={}}return _createClass(t,[{key:"reset",value:function(){this.registry={}}},{key:"putItem",value:function(e){var t=this.getKey(e);t&&(this.registry[t]||(this.registry[t]=[]),this.registry[t].push(e))}},{key:"getItemList",value:function(e){return this.registry[e]||[]}},{key:"filter",value:function(e){var t={};for(var n in this.registry){var r=this.registry[n];e(r)&&(t[n]=r)}return t}}]),t}(),TimelineInteractive=function(){function n(e,t){_classCallCheck(this,n),this.props=e,this.timeline=t,this.selectedScrobble=null,this.pointCollectionHighlighted=new Collection,this.genrePointRegistry=new Registry(function(e){return e.scrobble.artist.genre}),this.artistPointRegistry=new Registry(function(e){return e.scrobble.artist.name}),this.isPlotMouseDown=!1,this.plotMouseX=null,Object.assign(this.timeline.props,{onScrobblePointCreate:this.handleScrobblePointCreate.bind(this),onPlotMouseDown:this.handlePlotMouseDown.bind(this),onPlotMouseUp:this.handlePlotMouseUpOrOut.bind(this),onPlotMouseOut:this.handlePlotMouseUpOrOut.bind(this),onPlotMouseMove:this.handlePlotMouseMove.bind(this),onPlotWheel:this.handlePlotWheel.bind(this),onLegendGenreMouseEnter:this.handleLegendGenreMouseEnter.bind(this)}),["draw","beforeRender","render"].forEach(createProxyMethod(this,this.timeline)),this.handleWindowResize=this.handleWindowResize.bind(this),this.handleDocumentKeydown=this.handleDocumentKeydown.bind(this)}return _createClass(n,[{key:"subscribe",value:function(){window.addEventListener("resize",this.handleWindowResize),document.addEventListener("keydown",this.handleDocumentKeydown)}},{key:"unsubscribe",value:function(){Object.values(this.timeline.children).forEach(function(e){"function"==typeof e.unsubscribe&&e.unsubscribe()}),window.removeEventListener("resize",this.handleWindowResize),document.removeEventListener("keydown",this.handleDocumentKeydown)}},{key:"resetScales",value:function(){this.timeline.children.plot.scale(),this.timeline.plotScales=this.timeline.getPlotScales()}},{key:"resetState",value:function(){this.timeline.pointBuffer.reset(),this.genrePointRegistry.reset(),this.artistPointRegistry.reset(),this.pointCollectionHighlighted.reset(),this.selectedScrobble=null}},{key:"resetUi",value:function(){var e=this.timeline.children,t=e.infoBox,n=e.selectedScrobbleTimeLabel,r=e.legend,i=e.artistLabelCollection;t.showIntroMessage(),n.clear(),r.removeGenreHighlight(),i.removeAllLabels()}},{key:"highlightGenre",value:function(e,t){var o=this,l=1<arguments.length&&void 0!==t?t:null,s=this.timeline.children.plot,u={};return this.genrePointRegistry.getItemList(e).forEach(function(e){var t=e.x,n=e.y,r=e.scrobble,i=r.artist.name,a=r.highlightedGenreColor;i!==l&&(o.pointCollectionHighlighted.push({x:t,y:n}),u[i]=e,s.drawPoint(t,n,a))}),u}},{key:"highlightArtist",value:function(e){var s=this,u=e.index,t=e.artist,c=e.track,r=config.timeline.point.selectedColor,n=this.timeline.children,f=n.plot,h=n.selectedScrobbleTimeLabel,m=_slicedToArray(f.getDimensions(),1)[0],d=[],g=null;return this.artistPointRegistry.getItemList(t.name).forEach(function(e){var t=e.x,n=e.y,r=e.scrobble,i=r.index,a=r.timestamp,o=r.track.name,l=r.highlightedArtistColor;s.pointCollectionHighlighted.push({x:t,y:n}),g=e,o===c.name?d.push({x:t,y:n}):f.drawPoint(t,n,l),i===u&&h.renderText(t,timestampToDateTimeString(a),m)}),d.forEach(function(e){var t=e.x,n=e.y;return f.drawPoint(t,n,r)}),g}},{key:"removePointsHighlight",value:function(){var r=this.timeline.pointBuffer,i=this.timeline.children.plot;this.pointCollectionHighlighted.getAll().forEach(function(e){var t=e.x,n=e.y;return i.drawPoint(t,n,r.getPoint(t,n).scrobble.color)}),this.pointCollectionHighlighted.reset()}},{key:"selectGenre",value:function(e){var t=this.timeline.children.legend;this.selectedScrobble=null,this.removePointsHighlight(),this.resetUi(),this.renderArtistsLabels(this.highlightGenre(e)),t.highlightGenre(e)}},{key:"selectScrobble",value:function(e){var t=this.props.summary,n=this.timeline.children,r=n.plot,i=n.infoBox,a=n.legend,o=n.artistLabelCollection,l=_slicedToArray(r.getDimensions(),1)[0],s=e.artist,u=!(this.selectedScrobble&&this.selectedScrobble.artist.name===s.name),c={};this.selectedScrobble=e,this.removePointsHighlight(),i.hideIntroMessage(),u&&(a.removeGenreHighlight(),o.removeAllLabels()),s.genre&&(c=this.highlightGenre(s.genre,s.name),u&&a.highlightGenre(s.genre));var f=this.highlightArtist(e);u&&(o.renderLabel(_objectSpread2({text:s.name},f),l,!0),this.renderArtistsLabels(c)),i.renderScrobbleInfo(e,t.getScrobbleTotals(e))}},{key:"selectVerticallyAdjacentScrobble",value:function(e){var t=this.timeline.scrobbleCollection;if(this.selectedScrobble){var n=t.getAdjacentVisible(this.selectedScrobble.index,e);n&&this.selectScrobble(n)}}},{key:"selectHorizontallyAdjacentScrobble",value:function(e){var t=this,n=this.timeline.scrobbleCollection;if(this.selectedScrobble){var r=n.getAdjacentVisible(this.selectedScrobble.index,e,function(e){return e.artist.playcount===t.selectedScrobble.artist.playcount});r&&this.selectScrobble(r)}}},{key:"selectScrobbleUnderMouse",value:function(e){var t=this.timeline.pointBuffer,n=e.offsetX,r=e.offsetY,i=t.getPointWithTolerance(n,r);i&&i.scrobble!==this.selectedScrobble&&this.selectScrobble(i.scrobble)}},{key:"panPlot",value:function(e){var t=this.timeline,n=t.scrobbleCollection,r=t.plotScales.x,i=e.offsetX,a=n.getFirst().timestamp,o=n.getLast().timestamp,l=_slicedToArray(r.domain().map(function(e){return Date.parse(e)}),2),s=l[0],u=l[1];if(!(o-a<=u-s)){var c=r.invert(this.plotMouseX)-r.invert(i);c&&(o<u+c?c=o-u:s+c<a&&(c=a-s),c&&this.updatePlotTimeRange(s+c,u+c))}}},{key:"zoomPlot",value:function(e){var t=config.timeline,n=t.zoomDeltaFactor,r=t.minTimeRange,i=t.plot.padding,a=this.timeline,o=a.scrobbleCollection,l=a.plotScales.x,s=this.timeline.children.plot,u=e.offsetX,c=e.deltaY,f=l.domain(),h=_slicedToArray(s.getDimensions(),1)[0]-2*i,m=linear$1().domain([0,h]).rangeRound(f),d=m(clamp.apply(void 0,[u-i].concat(_toConsumableArray(m.domain())))),g=1-c*n,p=(d-f[0])/g,b=(f[1]-d)/g;r<=p+b&&this.updatePlotTimeRange(Math.max(d-p,o.getFirst().timestamp),Math.min(d+b,o.getLast().timestamp))}},{key:"updatePlotTimeRange",value:function(n,t){var e=this.timeline,r=e.scrobbleCollection,i=e.plotScales.x,a=r.findFirst(function(e){var t=e.timestamp;return n<=t}).index,o=r.findLast(function(e){return e.timestamp<=t}).index;i.domain([n,t]),r.setVisibleIndexRange(a,o),this.resetState(),this.draw(),this.resetUi()}},{key:"handleScrobblePointCreate",value:function(e){this.genrePointRegistry.putItem(e),this.artistPointRegistry.putItem(e)}},{key:"handleWindowResize",value:function(){var e=this;clearTimeout(this.windowResizeTimeoutHandle),this.windowResizeTimeoutHandle=setTimeout(function(){e.resetScales(),e.resetState(),e.draw(),e.resetUi()},100)}},{key:"handleDocumentKeydown",value:function(e){switch(e.key){case"Escape":return this.handleEscKeydown();case"ArrowDown":return this.selectVerticallyAdjacentScrobble(-1);case"ArrowUp":return this.selectVerticallyAdjacentScrobble(1);case"ArrowLeft":return this.selectHorizontallyAdjacentScrobble(-1);case"ArrowRight":return this.selectHorizontallyAdjacentScrobble(1)}}},{key:"handleEscKeydown",value:function(){this.selectedScrobble=null,this.removePointsHighlight(),this.resetUi()}},{key:"handlePlotMouseDown",value:function(e){0===e.button&&(this.isPlotMouseDown=!0)}},{key:"handlePlotMouseUpOrOut",value:function(){this.isPlotMouseDown=!1}},{key:"handlePlotMouseMove",value:function(e){var t=e.offsetX;this.isPlotMouseDown?this.panPlot(e):this.selectScrobbleUnderMouse(e),this.plotMouseX=t}},{key:"handlePlotWheel",value:function(e){e.preventDefault(),this.zoomPlot(e)}},{key:"handleLegendGenreMouseEnter",value:function(e){this.selectGenre(e)}},{key:"afterRender",value:function(){this.timeline.afterRender(),this.subscribe()}},{key:"renderArtistsLabels",value:function(e){var t=this.timeline.children,n=t.plot,r=t.artistLabelCollection,i=_slicedToArray(n.getDimensions(),1)[0];Object.entries(e).map(function(e){var t=_slicedToArray(e,2);return _objectSpread2({text:t[0]},t[1])}).sort(function(e,t){return t.y-e.y}).forEach(function(e){return r.renderLabel(e,i,!1)})}}]),n}();function _templateObject2$3(){var e=_taggedTemplateLiteral(["",""]);return _templateObject2$3=function(){return e},e}var dataCache={},currentTimeline=null;function retrieveAll(e){return Promise.all(e.map(retrieve))}function retrieve(t){return dataCache[t]?Promise.resolve(dataCache[t]):fetch(t).then(function(e){return e.json()}).then(function(e){return dataCache[t]=e})}function transform(e){var t=_slicedToArray(e,3),n=t[0],r=t[1],i=t[2],a=r.map(function(e,t){return _objectSpread2(_objectSpread2({},uncompress(e)),{},{index:t,timestamp:dateTimeStringToTimestamp(e[0])})}),o=getSummary(a);return{yearList:n,summary:o,scrobbleList:insertColors(insertGenres(a,i),o.maxAlbumPlaycount)}}function render(e){var t=new TimelineInteractive(e,new Timeline(e));return currentTimeline&&currentTimeline.unsubscribe(),t.beforeRender(),document.body.innerHTML=t.render(),t.afterRender(),t.draw(),currentTimeline=t}function logMissingGenreArtists(e){}function createTimeline(e){retrieveAll([config.dataUrls.yearList,"".concat(config.dataUrls.yearsBase,"/").concat(e,".json"),config.dataUrls.artistsByGenres]).then(transform).then(render).then(logMissingGenreArtists)}var router=new Router(_defineProperty({"":function(){return document.location.hash=config.defaultDataYear},all:createTimeline},parse(_templateObject2$3(),/\d{4}/),createTimeline));router.start();
//# sourceMappingURL=bundle.min.js.map
